{"ast":null,"code":"import _regeneratorRuntime from \"D:/HTML_CSS/popcorn-v3/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"D:/HTML_CSS/popcorn-v3/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.regexp.test.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.regexp.to-string.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport UserApi from '../api/UserApi.js';\nimport OtpApi from '../api/OtpApi.js';\nexport default {\n  name: \"ui-otp\",\n  mounted: function mounted() {//\n\n    return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  data: function data() {\n    return {\n      step: 1,\n      img: require(\"../assets/4498897.jpg\"),\n      uPhone: \"\",\n      uPrefix: {\n        country: \"VIE\",\n        img: require('../assets/vietnam.png'),\n        prefix: \"84\"\n      },\n      legalPhone: '',\n      countryPrefix: [{\n        country: \"VIE\",\n        img: require('../assets/vietnam.png'),\n        prefix: \"84\"\n      }, {\n        country: \"CHN\",\n        img: require('../assets/china.png'),\n        prefix: \"86\"\n      }, {\n        country: \"USA\",\n        img: require('../assets/united-states.png'),\n        prefix: \"1\"\n      }, {\n        country: \"THA\",\n        img: require('../assets/thailand.png'),\n        prefix: \"81\"\n      }],\n      phoneRule: [function (v) {\n        return !!v || \"Phone number is required!\";\n      }, function (v) {\n        return v && v.length <= 12 || \"Phone number must less than 12 numbers\";\n      }, function (v) {\n        return /\\d+$/.test(v) || \"Invalid phone number!\";\n      }],\n      otpVal: '',\n      sysOtp: null\n    };\n  },\n  // mounted() {\n  //     function compare(a,b){\n  //         if(a.country < b.country) return -1\n  //         if(a.country > b.country) return 1\n  //         return 0\n  //     }\n  //   this.countryPrefix.sort(compare)\n  // },\n  methods: {\n    getOtp: function getOtp() {\n      if (this.$refs.phoneInput.validate()) {\n        this.legalPhone = this.uPrefix.prefix + this.uPhone;\n        this.sysOtp = OtpApi.generateOtp(6);\n        var otpMessage = {\n          number: this.legalPhone,\n          text: \"Your OTP number is: \" + this.sysOtp\n        };\n        OtpApi.sendSms(otpMessage);\n        this.step = 2;\n      }\n    },\n    retypePhone: function retypePhone() {\n      this.step = 1;\n    },\n    submitOtp: function submitOtp() {},\n    filter: function filter($event) {\n      if ($event.key == \"Enter\") {\n        this.getOtp();\n        return;\n      }\n\n      if (this.uPhone.length == 12) {\n        $event.preventDefault();\n        return;\n      }\n\n      var reg = /\\d+$/;\n      if (!reg.test($event.key)) $event.preventDefault();\n    },\n    createToken: function createToken() {\n      return Math.random().toString(36).substr(2) + Math.random().toString(36).substr(2);\n    },\n    checkUser: function checkUser(phone) {\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var user;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return UserApi.findPhone(phone);\n\n              case 2:\n                user = _context2.sent;\n                console.log(user);\n\n              case 4:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }))();\n    },\n    verifyOtp: function verifyOtp() {\n      var _this = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        var user, token;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (!(_this.otpVal === _this.sysOtp)) {\n                  _context3.next = 17;\n                  break;\n                }\n\n                _context3.next = 3;\n                return UserApi.findPhone(_this.legalPhone);\n\n              case 3:\n                user = _context3.sent;\n\n                if (!(user.length === 1)) {\n                  _context3.next = 14;\n                  break;\n                }\n\n                token = _this.createToken();\n                localStorage.setItem('token', token);\n                user[0]._token = token;\n                _context3.next = 10;\n                return UserApi.update(user[0]._id, user);\n\n              case 10:\n                _this.$cookies.remove('on_register_token');\n\n                _this.$router.push(\"/\");\n\n                _context3.next = 17;\n                break;\n\n              case 14:\n                _this.$cookies.set('on_register_token', _this.createToken(), 1800);\n\n                _this.$cookies.set('phone', _this.legalPhone, 1800);\n\n                _this.$router.push(\"Register\");\n\n              case 17:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }))();\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqEA;AACA;AACA;EACAA,cADA;EAEAC,OAFA,qBAEA,CACA;;IADA;MAAA;QAAA;UAAA;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA;EAEA,CAJA;EAKAC,IALA,kBAKA;IACA;MACAC,OADA;MAEAC,qCAFA;MAGAC,UAHA;MAIAC;QAAAC;QAAAH;QAAAI;MAAA,CAJA;MAKAC,cALA;MAMAC,gBACA;QAAAH;QAAAH;QAAAI;MAAA,CADA,EAEA;QAAAD;QAAAH;QAAAI;MAAA,CAFA,EAGA;QAAAD;QAAAH;QAAAI;MAAA,CAHA,EAIA;QAAAD;QAAAH;QAAAI;MAAA,CAJA,CANA;MAYAG,YACA;QAAA;MAAA,CADA,EAEA;QAAA;MAAA,CAFA,EAGA;QAAA;MAAA,CAHA,CAZA;MAiBAC,UAjBA;MAkBAC;IAlBA;EAoBA,CA1BA;EA2BA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACAC;IACAC,MADA,oBACA;MACA;QACA;QACA;QACA;UACAC,uBADA;UAEAC;QAFA;QAIAC;QACA;MACA;IAGA,CAdA;IAeAC,WAfA,yBAeA;MACA;IACA,CAjBA;IAkBAC,SAlBA,uBAkBA,CACA,CAnBA;IAoBAC;MACA;QACA;QACA;MACA;;MACA;QACAC;QACA;MACA;;MACA;MACA;IACA,CA/BA;IAgCAC,WAhCA,yBAgCA;MACA;IACA,CAlCA;IAmCAC,SAnCA,qBAmCAC,KAnCA,EAmCA;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA,OACAC,wBADA;;cAAA;gBACAC,IADA;gBAEAC;;cAFA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAGA,CAtCA;IAuCAC,SAvCA,uBAuCA;MAAA;;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,MACA,6BADA;kBAAA;kBAAA;gBAAA;;gBAAA;gBAAA,OAGAH,mCAHA;;cAAA;gBAGAC,IAHA;;gBAAA,MAIAA,iBAJA;kBAAA;kBAAA;gBAAA;;gBAKAG,KALA,GAKA,mBALA;gBAMAC;gBACAJ;gBAPA;gBAAA,OAQAD,iCARA;;cAAA;gBASA;;gBACA;;gBAVA;gBAAA;;cAAA;gBAaA;;gBACA;;gBACA;;cAfA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAkBA;EAzDA;AAnCA","names":["name","mounted","data","step","img","uPhone","uPrefix","country","prefix","legalPhone","countryPrefix","phoneRule","otpVal","sysOtp","methods","getOtp","number","text","OtpApi","retypePhone","submitOtp","filter","$event","createToken","checkUser","phone","UserApi","user","console","verifyOtp","token","localStorage"],"sourceRoot":"src/components","sources":["otp.vue"],"sourcesContent":["<template>\r\n  <v-layout class=\"otp d-flex justify-center\">\r\n    <v-card class=\"otp__card align-self-center\">\r\n      <v-stepper v-model=\"step\" class=\"otp__stepper\" elevation=\"0\">\r\n        <v-stepper-items>\r\n          <v-stepper-content step=\"1\">\r\n            <v-card>\r\n              <v-img class=\"mx-auto\" width=\"300\" :src=\"img\"></v-img>\r\n              <h5>Please let we know your phone number</h5>\r\n              <v-layout class=\"d-flex my-3\">\r\n                <v-select\r\n                  class=\"otp__input otp__number-prefix mr-3\"\r\n                  flat\r\n                  outlined\r\n                  hide-details\r\n                  :items=\"countryPrefix\"\r\n                  item-text=\"country\"\r\n                  item-value=\"prefix\"\r\n                  return-object\r\n                  v-model=\"uPrefix\"\r\n                >\r\n                <template v-slot:selection=\"{item}\">\r\n                    <v-layout class=\"d-flex\">\r\n                        <v-img width=\"15\" :src=\"item.img\"></v-img>\r\n                        <h4 class=\"ml-0 ml-md-2\">+{{item.prefix}}</h4>\r\n                    </v-layout>\r\n                </template>\r\n                <template v-slot:item=\"{item}\">\r\n                    <v-layout class=\"d-flex\">\r\n                        <v-img class=\"align-self-center\" width=\"15\" :src=\"item.img\"></v-img>\r\n                        <h5 class=\"ml-0 ml-md-2 align-self-center\">{{item.country}}</h5>\r\n                    </v-layout>\r\n                </template>\r\n                </v-select>\r\n                <v-text-field\r\n                  ref=\"phoneInput\"\r\n                  class=\"otp__input otp__number-field\"\r\n                  outlined\r\n                  v-model=\"uPhone\"\r\n                  @keypress=\"filter($event)\"\r\n                  :rules=\"phoneRule\"\r\n                ></v-text-field>\r\n              </v-layout>\r\n              <v-card-actions class=\"ma-0 pa-0\">\r\n                <v-btn width=\"100%\" x-large @click=\"getOtp()\" color=\"primary\">Get OTP</v-btn>\r\n              </v-card-actions>\r\n            </v-card>\r\n          </v-stepper-content>\r\n          <v-stepper-content step=\"2\" class=\"otp__stepper\">\r\n            <v-card>\r\n              <v-layout class=\"d-flex flex-column\">\r\n                  <h4>Code is sent to +<span class=\"primary--text\">{{legalPhone}}</span></h4>\r\n                  <v-otp-input v-model=\"otpVal\" class=\"mt-10\" length=\"6\" type=\"number\"></v-otp-input>\r\n                  <v-img width=\"200\" class=\"mx-auto\" :src=\"require('../assets/message.gif')\" alt=\"#\"></v-img>\r\n                  <h4 class=\"my-3\">Didn't receive code? <span class=\"primary--text\">Re-send code</span></h4>\r\n              </v-layout>\r\n                <v-card-actions class=\"pa-0 ma-0 mt-5\">\r\n                  <v-btn class=\"my-1\" x-large width=\"50%\" color=\"secondary\" @click=\"retypePhone\" elevation=\"0\">Back</v-btn>\r\n                <v-btn @click=\"verifyOtp()\" class=\"my-1\" x-large width=\"50%\" color=\"primary\" elevation=\"0\">Submit</v-btn>\r\n                </v-card-actions>\r\n            </v-card>\r\n          </v-stepper-content>\r\n        </v-stepper-items>\r\n      </v-stepper>\r\n    </v-card>\r\n  </v-layout>\r\n</template>\r\n\r\n<script>\r\nimport UserApi from '../api/UserApi.js'\r\nimport OtpApi from '../api/OtpApi.js'\r\nexport default {\r\n  name: \"ui-otp\",\r\n  async mounted(){\r\n    //\r\n  },\r\n  data() {\r\n    return {\r\n      step: 1,\r\n      img: require(\"../assets/4498897.jpg\"),\r\n      uPhone: \"\",\r\n      uPrefix: { country: \"VIE\", img: require('../assets/vietnam.png'), prefix: \"84\" },\r\n      legalPhone: '',\r\n      countryPrefix: [\r\n        { country: \"VIE\", img: require('../assets/vietnam.png'), prefix: \"84\" },\r\n        { country: \"CHN\", img: require('../assets/china.png'), prefix: \"86\" },\r\n        { country: \"USA\", img: require('../assets/united-states.png'), prefix: \"1\" },\r\n        { country: \"THA\", img: require('../assets/thailand.png'), prefix: \"81\" },\r\n      ],\r\n      phoneRule:[\r\n          v=>!!v || \"Phone number is required!\",\r\n          v=>(v && v.length <=12) || \"Phone number must less than 12 numbers\",\r\n          v => /\\d+$/.test(v) || \"Invalid phone number!\"\r\n      ],\r\n      otpVal: '',\r\n      sysOtp: null,\r\n    };\r\n  },\r\n  // mounted() {\r\n  //     function compare(a,b){\r\n  //         if(a.country < b.country) return -1\r\n  //         if(a.country > b.country) return 1\r\n  //         return 0\r\n  //     }\r\n  //   this.countryPrefix.sort(compare)\r\n  // },\r\n  methods: {\r\n     getOtp(){\r\n      if(this.$refs.phoneInput.validate()){\r\n          this.legalPhone = this.uPrefix.prefix + this.uPhone\r\n          this.sysOtp = OtpApi.generateOtp(6)\r\n          const otpMessage  = {\r\n            number: this.legalPhone,\r\n            text: \"Your OTP number is: \" + this.sysOtp\r\n          }\r\n          OtpApi.sendSms(otpMessage)\r\n          this.step = 2\r\n      }\r\n      \r\n\r\n    },\r\n    retypePhone() {\r\n      this.step = 1;\r\n    },\r\n    submitOtp() {\r\n    },\r\n    filter: function($event){\r\n        if($event.key == \"Enter\"){\r\n          this.getOtp()\r\n          return\r\n        }\r\n        if(this.uPhone.length ==12){\r\n            $event.preventDefault()\r\n            return\r\n        }\r\n        let reg = /\\d+$/\r\n        if(!reg.test($event.key)) $event.preventDefault()\r\n    },\r\n    createToken(){\r\n      return Math.random().toString(36).substr(2) + Math.random().toString(36).substr(2)\r\n    },\r\n    async checkUser(phone){\r\n      const user = await UserApi.findPhone(phone)\r\n      console.log(user)\r\n    },\r\n    async verifyOtp(){\r\n      if(this.otpVal === this.sysOtp){\r\n        //Get user info\r\n        const user = await UserApi.findPhone(this.legalPhone)\r\n        if(user.length === 1){\r\n          const token = this.createToken()\r\n          localStorage.setItem('token', token)\r\n          user[0]._token = token\r\n          await UserApi.update(user[0]._id, user)\r\n          this.$cookies.remove('on_register_token')\r\n          this.$router.push(\"/\")\r\n        }\r\n        else{\r\n          this.$cookies.set('on_register_token', this.createToken() , 1800)\r\n          this.$cookies.set('phone', this.legalPhone, 1800)\r\n          this.$router.push(\"Register\")\r\n        }\r\n      }\r\n    }\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.otp {\r\n  width: 100%;\r\n  height: 100vh;\r\n}\r\n.otp .otp__card {\r\n  max-width: 400px;\r\n  min-height: 500;\r\n}\r\n.otp .otp__number-prefix {\r\n  width: 25%;\r\n}\r\n.otp .otp__number-field{\r\n    width: 60%;\r\n    font-size: 18px;\r\n    font-weight: 600;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}