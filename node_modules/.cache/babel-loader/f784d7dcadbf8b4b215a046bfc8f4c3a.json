{"ast":null,"code":"import _regeneratorRuntime from \"D:/HTML_CSS/popcorn-v3/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"D:/HTML_CSS/popcorn-v3/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.regexp.test.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport UserApi from '../../api/UserApi';\nimport OtpApi from '../../api/OtpApi';\nexport default {\n  name: 'ui-acc-info',\n  data: function data() {\n    return {\n      infoChange: false,\n      phoneChange: false,\n      user: {},\n      userAfterEdit: null,\n      verifyMsg: null,\n      username: null,\n      verify: true,\n      numberVerify: true,\n      numberVerifyMsg: null,\n      otp: null,\n      serverOtp: null,\n      snackbar: {\n        visible: false,\n        msg: \"\"\n      }\n    };\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _this.loadData();\n\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  methods: {\n    verifyUsername: function verifyUsername() {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var user;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _this2.infoChange = true;\n\n                if (!(_this2.user._username.length >= 6 && _this2.user._username.length <= 18)) {\n                  _context2.next = 8;\n                  break;\n                }\n\n                _context2.next = 4;\n                return UserApi.findUsername(_this2.user._username);\n\n              case 4:\n                user = _context2.sent;\n\n                if (user.length === 1) {\n                  _this2.verify = false;\n                  _this2.verifyMsg = 'This name is already taken!';\n                } else {\n                  _this2.verify = true;\n                  _this2.verifyMsg = null;\n                }\n\n                _context2.next = 9;\n                break;\n\n              case 8:\n                if (_this2.user._username.length < 6) {\n                  _this2.verify = false;\n                  _this2.verifyMsg = 'Username must at least 6 characters';\n                } else {\n                  _this2.verify = false;\n                  _this2.verifyMsg = 'Username must at most 18 characters';\n                }\n\n              case 9:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }))();\n    },\n    loadData: function loadData() {\n      var _this3 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        var dbUser;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return UserApi.findToken(localStorage.getItem('token'));\n\n              case 2:\n                dbUser = _context3.sent;\n                _this3.user = dbUser[0];\n                _this3.userAfterEdit = Object.assign({}, _this3.user);\n\n              case 5:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }))();\n    },\n    discardChange: function discardChange() {\n      this.infoChange = false;\n      this.phoneChange = false;\n      Object.assign(this.user, this.userAfterEdit);\n    },\n    verifyCharacter: function verifyCharacter($event) {\n      var reg = /^(?![0-9])([a-zA-Z0-9])+$/;\n      if (!reg.test(this.user._username + $event.key)) $event.preventDefault();\n    },\n    changeNumber: function changeNumber() {\n      this.infoChange = true;\n      this.phoneChange = true;\n      this.numberVerify = false;\n    },\n    sendOtp: function sendOtp() {\n      this.serverOtp = OtpApi.generateOtp(6);\n      var otpMsg = \"Your OTP is \" + this.serverOtp + \" .\";\n      OtpApi.sendSms(\"+\" + this.user._phone, otpMsg);\n    },\n    checkOtp: function checkOtp() {\n      if (this.serverOtp == this.otp) {\n        this.numberVerify = true;\n        this.numberVerifyMsg = 'Verified!';\n      } else {\n        this.numberVerifyMsg = \"Wrong OTP Code!\";\n      }\n    },\n    updateUser: function updateUser() {\n      var _this4 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n        var updateUser, dbMsg;\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                if (!(_this4.verify === true && _this4.numberVerify === true)) {\n                  _context4.next = 17;\n                  break;\n                }\n\n                updateUser = {\n                  0: _this4.user\n                };\n                _context4.next = 4;\n                return UserApi.update(_this4.user._id, updateUser);\n\n              case 4:\n                dbMsg = _context4.sent;\n\n                if (!(dbMsg == 200)) {\n                  _context4.next = 15;\n                  break;\n                }\n\n                _this4.snackbar.visible = true;\n                _this4.snackbar.msg = \"Update suceessfully\";\n                _this4.infoChange = false;\n                _context4.next = 11;\n                return _this4.loadData();\n\n              case 11:\n                _context4.next = 13;\n                return _this4.$emit('loadUser');\n\n              case 13:\n                _context4.next = 17;\n                break;\n\n              case 15:\n                _this4.snackbar.visible = true;\n                _this4.snackbar.msg = \"Error to connect database\";\n\n              case 17:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }))();\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuCA;AACA;AACA;EACAA,mBADA;EAEAC,IAFA,kBAEA;IACA;MACAC,iBADA;MAEAC,kBAFA;MAGAC,QAHA;MAIAC,mBAJA;MAKAC,eALA;MAMAC,cANA;MAOAC,YAPA;MAQAC,kBARA;MASAC,qBATA;MAUAC,SAVA;MAWAC,eAXA;MAYAC;QACAC,cADA;QAEAC;MAFA;IAZA;EAiBA,CApBA;EAqBAC,OArBA,qBAqBA;IAAA;;IAAA;MAAA;QAAA;UAAA;YAAA;cAAA;cAAA,OACA,gBADA;;YAAA;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA;EAEA,CAvBA;EAwBAC;IACAC,cADA,4BACA;MAAA;;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBACA;;gBADA,MAEA,uEAFA;kBAAA;kBAAA;gBAAA;;gBAAA;gBAAA,OAGAC,2CAHA;;cAAA;gBAGAf,IAHA;;gBAIA;kBACA;kBACA;gBACA,CAHA,MAIA;kBACA;kBACA;gBACA;;gBAXA;gBAAA;;cAAA;gBAaA;kBACA;kBACA;gBACA,CAHA,MAIA;kBACA;kBACA;gBACA;;cApBA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAqBA,CAtBA;IAuBAgB,QAvBA,sBAuBA;MAAA;;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA;gBAAA,OACAD,gDADA;;cAAA;gBACAE,MADA;gBAEA;gBACA;;cAHA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAIA,CA3BA;IA4BAC,aA5BA,2BA4BA;MACA;MACA;MACAC;IACA,CAhCA;IAiCAC,eAjCA,2BAiCAC,MAjCA,EAiCA;MACA;MACA;IACA,CApCA;IAqCAC,YArCA,0BAqCA;MACA;MACA;MACA;IACA,CAzCA;IA0CAC,OA1CA,qBA0CA;MACA;MACA;MACAC;IACA,CA9CA;IA+CAC,QA/CA,sBA+CA;MACA;QACA;QACA;MACA,CAHA,MAGA;QACA;MACA;IACA,CAtDA;IAuDAC,UAvDA,wBAuDA;MAAA;;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,MACA,sDADA;kBAAA;kBAAA;gBAAA;;gBAEAA,UAFA,GAEA;kBAAA;gBAAA,CAFA;gBAAA;gBAAA,OAGAX,2CAHA;;cAAA;gBAGAY,KAHA;;gBAAA,MAIAA,YAJA;kBAAA;kBAAA;gBAAA;;gBAKA;gBACA;gBACA;gBAPA;gBAAA,OAQA,iBARA;;cAAA;gBAAA;gBAAA,OASA,wBATA;;cAAA;gBAAA;gBAAA;;cAAA;gBAYA;gBACA;;cAbA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAgBA;EAvEA;AAxBA","names":["name","data","infoChange","phoneChange","user","userAfterEdit","verifyMsg","username","verify","numberVerify","numberVerifyMsg","otp","serverOtp","snackbar","visible","msg","mounted","methods","verifyUsername","UserApi","loadData","dbUser","discardChange","Object","verifyCharacter","$event","changeNumber","sendOtp","OtpApi","checkOtp","updateUser","dbMsg"],"sourceRoot":"src/components/home","sources":["AccountInfo.vue"],"sourcesContent":["<template>\r\n   <v-card dark flat tile min-height=\"100vh\" class=\"pt--20 px-8\">\r\n      <h3>Personal Information</h3>\r\n      <v-card flat tile class=\"information__edit mt-3\">\r\n            <h4 class=\"py-2\">Username:</h4>\r\n            <v-text-field @keyup=\"verifyUsername()\" @keypress=\"verifyCharacter($event)\" v-model=\"user._username\"  hide-details outlined color=\"primary\"></v-text-field>\r\n            <h6 :style=\"`color:${this.$vuetify.theme.themes.light.primary}`\">{{verifyMsg}}</h6>\r\n             <h4 class=\"py-2\">Phone:</h4>\r\n            <v-text-field  @keyup=\"changeNumber()\" v-model=\"user._phone\" hide-details outlined color=\"primary\"></v-text-field>\r\n            <v-card v-if=\"phoneChange === true\" flat tile class=\"pa-3 d-flex flex-wrap\">\r\n                <v-otp-input length=\"6\" v-model=\"otp\"></v-otp-input>\r\n                <v-btn  @click=\"sendOtp()\" color=\"primary\" class=\"align-self-center\">GET OTP</v-btn>\r\n                 <v-btn @click=\"checkOtp()\" color=\"primary\" class=\"align-self-center\">Verify</v-btn>\r\n                 <h6 v-if=\"numberVerifyMsg\" :style=\"`color:${this.$vuetify.theme.themes.light.primary}`\">{{numberVerifyMsg}}</h6>\r\n            </v-card>\r\n\r\n            <v-card-actions v-if=\"infoChange === true\" transition=\"scroll-y-transition\" class=\"px-0 justify-end\">\r\n                <v-btn @click=\"discardChange()\" color=\"secondary\">Discard</v-btn>\r\n                <v-btn @click=\"updateUser()\" right color=\"primary\">Update</v-btn>\r\n            </v-card-actions>\r\n            <h4 class=\"my-2\">Premium outdate: \r\n                <span>{{user._premium_outdate}}</span>\r\n            </h4>\r\n      </v-card>\r\n      <v-snackbar\r\n      :timeout=\"3000\"\r\n      :value=\"snackbar.visible\"\r\n      color=\"success\"\r\n      absolute\r\n      centered\r\n      rounded\r\n      bottom\r\n    >\r\n      {{snackbar.msg}}\r\n    </v-snackbar>\r\n   </v-card>\r\n</template>\r\n\r\n<script>\r\nimport UserApi from '../../api/UserApi'\r\nimport OtpApi from '../../api/OtpApi'\r\nexport default {\r\n    name: 'ui-acc-info',\r\n    data(){\r\n        return{\r\n            infoChange: false,\r\n            phoneChange: false,\r\n            user:{},\r\n            userAfterEdit: null,\r\n            verifyMsg: null,\r\n            username: null,\r\n            verify: true,\r\n            numberVerify: true,\r\n            numberVerifyMsg: null,\r\n            otp: null,\r\n            serverOtp: null,\r\n            snackbar:{\r\n                visible: false,\r\n                msg : \"\"\r\n            }\r\n        }\r\n    },\r\n    async mounted(){\r\n        await this.loadData()\r\n    },\r\n    methods:{\r\n        async verifyUsername(){\r\n            this.infoChange = true\r\n           if(this.user._username.length >= 6 && this.user._username.length <= 18){\r\n                const user = await UserApi.findUsername(this.user._username)\r\n                if(user.length === 1){\r\n                    this.verify =  false\r\n                    this.verifyMsg = 'This name is already taken!'\r\n                  }\r\n                else{\r\n                    this.verify =  true\r\n                    this.verifyMsg = null\r\n                }\r\n          }\r\n          else if(this.user._username.length < 6 ){\r\n            this.verify =  false\r\n            this.verifyMsg = 'Username must at least 6 characters'\r\n          }\r\n          else{\r\n            this.verify =  false\r\n            this.verifyMsg = 'Username must at most 18 characters'\r\n          }\r\n        },\r\n        async loadData(){\r\n            const dbUser = await UserApi.findToken(localStorage.getItem('token'))\r\n            this.user = dbUser[0]\r\n            this.userAfterEdit = Object.assign({}, this.user)\r\n        },\r\n        discardChange(){\r\n            this.infoChange = false\r\n            this.phoneChange = false\r\n            Object.assign(this.user, this.userAfterEdit)\r\n        },\r\n         verifyCharacter($event){\r\n          const reg = /^(?![0-9])([a-zA-Z0-9])+$/\r\n          if(!reg.test(this.user._username + $event.key)) $event.preventDefault()\r\n       },\r\n       changeNumber(){\r\n        this.infoChange = true\r\n        this.phoneChange = true\r\n        this.numberVerify = false\r\n       },\r\n       sendOtp(){\r\n        this.serverOtp = OtpApi.generateOtp(6)\r\n        const otpMsg = \"Your OTP is \"+ this.serverOtp + \" .\"\r\n        OtpApi.sendSms(\"+\" + this.user._phone, otpMsg)\r\n       },\r\n       checkOtp(){\r\n        if(this.serverOtp == this.otp){\r\n            this.numberVerify = true\r\n            this.numberVerifyMsg = 'Verified!'\r\n        }else{\r\n            this.numberVerifyMsg = \"Wrong OTP Code!\"\r\n        }\r\n       },\r\n       async updateUser(){\r\n        if(this.verify === true && this.numberVerify === true){\r\n            const updateUser = {0: this.user}\r\n            const dbMsg = await UserApi.update(this.user._id, updateUser)\r\n            if(dbMsg==200){\r\n              this.snackbar.visible = true\r\n              this.snackbar.msg = \"Update suceessfully\"\r\n              this.infoChange = false\r\n              await this.loadData()\r\n              await this.$emit('loadUser')\r\n            }\r\n            else{\r\n              this.snackbar.visible = true\r\n              this.snackbar.msg = \"Error to connect database\"\r\n            }\r\n        }\r\n       }\r\n    },\r\n}\r\n</script>\r\n\r\n<style>\r\n.pt--20{\r\n    padding-top: 80px;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}