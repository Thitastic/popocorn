{"ast":null,"code":"import _regeneratorRuntime from \"D:/HTML_CSS/popcorn-v3/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"D:/HTML_CSS/popcorn-v3/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.regexp.test.js\";\nimport \"core-js/modules/es.string.match.js\";\nimport \"core-js/modules/es.string.split.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport UserApi from '../api/UserApi';\nexport default {\n  name: 'new-account',\n  data: function data() {\n    return {\n      usernameVerify: null,\n      verifyMsg: 'Please enter Username!',\n      selectedPlan: 0,\n      usernameInput: '',\n      usernameRules: [],\n      plans: [{\n        title: 'Free',\n        img: require('../assets/resource_images/free.png'),\n        desc: 'Free member',\n        value: 0,\n        price: '0'\n      }, {\n        title: \"Movie's Lover\",\n        img: require('../assets/resource_images/p-30d.png'),\n        desc: 'Gives 30 days premium',\n        value: 30,\n        price: '49,000'\n      }, {\n        title: 'Soul of Cinema',\n        img: require('../assets/resource_images/p-90d.png'),\n        desc: 'Gives 90 days premium',\n        value: 90,\n        price: '119,000'\n      }, {\n        title: 'Directors',\n        img: require('../assets/resource_images/p-1y.png'),\n        desc: 'Gives 1 year premium',\n        value: 365,\n        price: '419,000'\n      }]\n    };\n  },\n  methods: {\n    selectePlan: function selectePlan() {\n      console.log('select');\n    },\n    verifyInput: function verifyInput($event) {\n      var reg = /^(?![0-9])([a-zA-Z0-9])+$/;\n      if (!reg.test(this.usernameInput + $event.key)) $event.preventDefault();\n    },\n    verifyUsername: function verifyUsername() {\n      var _this = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var user;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!(_this.usernameInput.length >= 6 && _this.usernameInput.length <= 18)) {\n                  _context.next = 7;\n                  break;\n                }\n\n                _context.next = 3;\n                return UserApi.findUsername(_this.usernameInput);\n\n              case 3:\n                user = _context.sent;\n\n                if (user.length > 0) {\n                  _this.usernameVerify = false;\n                  _this.verifyMsg = 'This name is already taken!';\n                } else {\n                  _this.usernameVerify = true;\n                  _this.verifyMsg = 'Nice!';\n                }\n\n                _context.next = 8;\n                break;\n\n              case 7:\n                if (_this.usernameInput.length < 6) {\n                  _this.usernameVerify = false;\n                  _this.verifyMsg = 'Username must at least 6 characters';\n                } else {\n                  _this.usernameVerify = false;\n                  _this.verifyMsg = 'Username must at most 18 characters';\n                }\n\n              case 8:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }))();\n    },\n    register: function register() {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var _document$cookie$matc, _document$cookie$matc2, phone, token, today, outdate, newUser, result;\n\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                console.log(_this2.selectedPlan);\n\n                if (!(_this2.usernameVerify == true)) {\n                  _context2.next = 19;\n                  break;\n                }\n\n                phone = ((_document$cookie$matc = document.cookie.match('(^|;)\\\\s*' + 'phone' + '\\\\s*=\\\\s*([^;]+)')) === null || _document$cookie$matc === void 0 ? void 0 : _document$cookie$matc.pop()) || '';\n                token = ((_document$cookie$matc2 = document.cookie.match('(^|;)\\\\s*' + 'on_register_token' + '\\\\s*=\\\\s*([^;]+)')) === null || _document$cookie$matc2 === void 0 ? void 0 : _document$cookie$matc2.pop()) || '';\n                today = new Date(Date.now());\n                outdate = today.setDate(today.getDate() + _this2.selectedPlan + 1);\n                outdate = new Date(outdate).toISOString().split('T')[0];\n                newUser = {\n                  _username: _this2.usernameInput,\n                  _phone: phone,\n                  _premium_outdate: outdate,\n                  _token: token\n                };\n                console.log(newUser); //INSERT NEW USER IF FREE PLAN\n\n                if (!(_this2.selectedPlan == 0)) {\n                  _context2.next = 17;\n                  break;\n                }\n\n                _context2.next = 12;\n                return UserApi.insert(newUser);\n\n              case 12:\n                result = _context2.sent;\n                console.log(result);\n\n                if (result === 200) {\n                  localStorage.setItem('token', token);\n\n                  _this2.$cookies.remove('on_register_token');\n\n                  _this2.$router.push('/');\n                } else {\n                  alert('ERR:' + result);\n                }\n\n                _context2.next = 19;\n                break;\n\n              case 17:\n                _this2.$router.push('/payment');\n\n                _this2.$cookies.set('user', newUser);\n\n              case 19:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }))();\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsCA;AACA;EACAA,mBADA;EAEAC,IAFA,kBAEA;IACA;MACAC,oBADA;MAEAC,mCAFA;MAGAC,eAHA;MAIAC,iBAJA;MAKAC,iBALA;MAQAC,QACA;QAAAC;QAAAC;QAAAC;QAAAC;QAAAC;MAAA,CADA,EAEA;QAAAJ;QAAAC;QAAAC;QAAAC;QAAAC;MAAA,CAFA,EAGA;QAAAJ;QAAAC;QAAAC;QAAAC;QAAAC;MAAA,CAHA,EAIA;QAAAJ;QAAAC;QAAAC;QAAAC;QAAAC;MAAA,CAJA;IARA;EAeA,CAlBA;EAmBAC;IACAC,WADA,yBACA;MACAC;IACA,CAHA;IAIAC,WAJA,uBAIAC,MAJA,EAIA;MACA;MACA;IACA,CAPA;IAQAC,cARA,4BAQA;MAAA;;MAAA;QAAA;QAAA;UAAA;YAAA;cAAA;gBAAA,MACA,mEADA;kBAAA;kBAAA;gBAAA;;gBAAA;gBAAA,OAEAC,yCAFA;;cAAA;gBAEAC,IAFA;;gBAGA;kBACA;kBACA;gBACA,CAHA,MAIA;kBACA;kBACA;gBACA;;gBAVA;gBAAA;;cAAA;gBAYA;kBACA;kBACA;gBACA,CAHA,MAIA;kBACA;kBACA;gBACA;;cAnBA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAoBA,CA5BA;IA6BAC,QA7BA,sBA6BA;MAAA;;MAAA;QAAA;;QAAA;UAAA;YAAA;cAAA;gBACAN;;gBADA,MAEA,6BAFA;kBAAA;kBAAA;gBAAA;;gBAGAO,KAHA,GAGA,uLAHA;gBAIAC,KAJA,GAIA,sMAJA;gBAKAC,KALA,GAKA,oBALA;gBAMAC,OANA,GAMAD,wDANA;gBAOAC;gBACAC,OARA,GAQA;kBACAC,+BADA;kBAEAC,aAFA;kBAGAC,yBAHA;kBAIAC;gBAJA,CARA;gBAcAf,qBAdA,CAgBA;;gBAhBA,MAiBA,wBAjBA;kBAAA;kBAAA;gBAAA;;gBAAA;gBAAA,OAkBAI,uBAlBA;;cAAA;gBAkBAY,MAlBA;gBAmBAhB;;gBACA;kBACAiB;;kBACA;;kBACA;gBACA,CAJA,MAKA;kBACAC;gBACA;;gBA3BA;gBAAA;;cAAA;gBAgCA;;gBACA;;cAjCA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IAoCA;EAjEA;AAnBA","names":["name","data","usernameVerify","verifyMsg","selectedPlan","usernameInput","usernameRules","plans","title","img","desc","value","price","methods","selectePlan","console","verifyInput","$event","verifyUsername","UserApi","user","register","phone","token","today","outdate","newUser","_username","_phone","_premium_outdate","_token","result","localStorage","alert"],"sourceRoot":"src/components","sources":["NewAccount.vue"],"sourcesContent":["<template>\r\n  <v-card elevation=\"0\" class=\"mt-10 mx-16 register\">\r\n    <h2 class=\"color--primary\">Welcome to Popcorn</h2>\r\n    <v-card class=\"mt-10\" elevation=\"0\">\r\n      <h4 class=\"mb-2\">Username *</h4>\r\n      <v-layout class=\"register__form\">\r\n        <v-text-field v-model=\"usernameInput\" @keypress=\"verifyInput($event)\"  @keyup=\"verifyUsername()\" hide-details placeholder=\"Ex: Alex123\" outlined></v-text-field>\r\n        <v-tooltip bottom color=\"warning\" transition=\"slide-x-transition\">\r\n                <template v-slot:activator=\"{on, attr}\">\r\n                    <v-icon class=\"px-2\" color=\"success\" v-if=\"usernameVerify === true\">mdi-check-decagram</v-icon>\r\n                    <v-icon v-bind=\"attr\" v-on=\"on\"  class=\"px-2\" color=\"error\" v-else-if=\"usernameVerify === false\">mdi-alert-decagram</v-icon>\r\n                    <v-icon v-bind=\"attr\" v-on=\"on\"  class=\"px-2\" color=\"warning\" v-else-if=\"usernameVerify === null\">mdi-decagram</v-icon>\r\n                </template>\r\n                <span>{{verifyMsg}}</span>\r\n        </v-tooltip>\r\n      </v-layout> \r\n      <h4 class=\"mt-3\">Plan *</h4>\r\n      <v-radio-group row v-model=\"selectedPlan\">\r\n        <v-layout v-for=\"(item, index) in plans\" :key=\"index\" class=\"register__plans\">\r\n          <v-hover>\r\n            <template v-slot:default=\"{hover}\">\r\n               <v-card @click=\"selectedPlan = item.value\" shaped :elevation=\"hover ? 6: 2\" width=\"100%\" class=\"pa-5 ma-2\">\r\n                    <h4 class=\"text-uppercase text-center color--primary mb-3\">{{item.title}}</h4>\r\n                    <v-img :src=\"item.img\" width=\"150\" class=\"mx-auto\"></v-img>\r\n                    <h2 class=\"text-center my-3\">VND {{item.price}}</h2>\r\n                    <h5 class=\"text-center\">{{item.desc}}</h5>\r\n                    <div v-if=\"item.value === selectedPlan\" ref=\"ribbon\" class=\"ribbon ribbon-top-right\"><span>Selected</span></div>\r\n                </v-card>\r\n          </template>\r\n          </v-hover>\r\n        </v-layout>\r\n      </v-radio-group>\r\n      <v-btn @click=\"register()\" color=\"primary\" x-large width=\"100%\">Register</v-btn>\r\n    </v-card>\r\n  </v-card>\r\n</template>\r\n\r\n<script>\r\nimport UserApi from '../api/UserApi'\r\nexport default {\r\n    name: 'new-account',\r\n    data(){\r\n      return{\r\n        usernameVerify: null,\r\n        verifyMsg: 'Please enter Username!',\r\n        selectedPlan: 0,\r\n        usernameInput: '',\r\n        usernameRules: [\r\n\r\n        ],\r\n        plans: [\r\n          {title: 'Free', img: require('../assets/resource_images/free.png'), desc: 'Free member', value: 0, price: '0'},\r\n          {title: `Movie's Lover`, img: require('../assets/resource_images/p-30d.png'), desc: 'Gives 30 days premium', value: 30, price: '49,000'},\r\n          {title: 'Soul of Cinema', img: require('../assets/resource_images/p-90d.png'), desc: 'Gives 90 days premium', value: 90, price: '119,000'},\r\n          {title: 'Directors', img: require('../assets/resource_images/p-1y.png'), desc: 'Gives 1 year premium', value: 365, price: '419,000'},\r\n        ]\r\n      }\r\n    },\r\n    methods:{\r\n       selectePlan(){\r\n         console.log('select')\r\n       },\r\n       verifyInput($event){\r\n        const reg = /^(?![0-9])([a-zA-Z0-9])+$/\r\n          if(!reg.test(this.usernameInput + $event.key)) $event.preventDefault()\r\n       },\r\n        async verifyUsername(){\r\n          if(this.usernameInput.length >= 6 && this.usernameInput.length <= 18){\r\n                const user = await UserApi.findUsername(this.usernameInput)\r\n                if(user.length > 0){\r\n                    this.usernameVerify =  false\r\n                    this.verifyMsg = 'This name is already taken!'\r\n                  }\r\n                else{\r\n                    this.usernameVerify =  true\r\n                    this.verifyMsg = 'Nice!'\r\n                }\r\n          }\r\n          else if(this.usernameInput.length < 6 ){\r\n            this.usernameVerify =  false\r\n            this.verifyMsg = 'Username must at least 6 characters'\r\n          }\r\n          else{\r\n            this.usernameVerify =  false\r\n            this.verifyMsg = 'Username must at most 18 characters'\r\n          }\r\n       },\r\n        async register(){\r\n          console.log(this.selectedPlan)\r\n          if(this.usernameVerify == true){\r\n              const phone = document.cookie.match('(^|;)\\\\s*' + 'phone' + '\\\\s*=\\\\s*([^;]+)')?.pop() || ''\r\n              const token = document.cookie.match('(^|;)\\\\s*' + 'on_register_token' + '\\\\s*=\\\\s*([^;]+)')?.pop() || ''\r\n              const today = new Date(Date.now())\r\n              let outdate = today.setDate(today.getDate() + this.selectedPlan + 1)\r\n              outdate = new Date(outdate).toISOString().split('T')[0]\r\n              const newUser = {\r\n              _username: this.usernameInput,\r\n              _phone: phone,\r\n              _premium_outdate: outdate,\r\n              _token: token\r\n              }\r\n              console.log(newUser)\r\n\r\n              //INSERT NEW USER IF FREE PLAN\r\n              if(this.selectedPlan == 0){\r\n                  const result = await UserApi.insert(newUser)\r\n                  console.log(result)\r\n                  if(result === 200){\r\n                      localStorage.setItem('token', token)\r\n                      this.$cookies.remove('on_register_token')\r\n                      this.$router.push('/')\r\n                  }\r\n                  else{\r\n                      alert('ERR:'+ result)\r\n                  }\r\n              }\r\n\r\n              //REDIRECT AND INSERT AT PAYMENT PAGE\r\n              else{\r\n                this.$router.push('/payment')\r\n                this.$cookies.set('user', newUser)\r\n              }\r\n         }\r\n       }\r\n    }\r\n}\r\n</script>\r\n\r\n<style>\r\n.color--primary{\r\n  color: #e31e2d;\r\n}\r\n.register .register__form{\r\n}\r\n\r\n.ribbon {\r\n  width: 120px;\r\n  height: 150px;\r\n  overflow: hidden;\r\n  position: absolute;\r\n}\r\n\r\n.ribbon::before,\r\n.ribbon::after {\r\n  position: absolute;\r\n  z-index: -1;\r\n  content: '';\r\n  display: block;\r\n  border: 5px solid #e31e2d;\r\n}\r\n.ribbon span {\r\n  position: absolute;\r\n  display: block;\r\n  width: 225px;\r\n  padding: 7px 0;\r\n  background-color: #e31e2d;\r\n  box-shadow: 0 2px 1px rgba(0,0,0,.1);\r\n  color: #fff;\r\n  text-shadow: 0 1px 1px rgba(0,0,0,.2);\r\n  text-transform: uppercase;\r\n  text-align: center;\r\n}\r\n\r\n/* top right*/\r\n.ribbon-top-right {\r\n  top: 0;\r\n  right: 0;\r\n}\r\n.ribbon-top-right::before,\r\n.ribbon-top-right::after {\r\n  border-top-color: transparent;\r\n  border-right-color: transparent;\r\n}\r\n.ribbon-top-right::before {\r\n  top: 0;\r\n  left: 22px;\r\n}\r\n.ribbon-top-right::after {\r\n  bottom: 22px;\r\n  right: 0;\r\n}\r\n.ribbon-top-right span {\r\n  left: -27px;\r\n  top: 29px;\r\n  transform: rotate(45deg);\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}